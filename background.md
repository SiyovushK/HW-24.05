# Техническое задание (ТЗ)

В этом задании нужно создать сущность Order (заказ) с несколькими типами доставки (например, экспресс, стандарт и т.д.) и реализовать фоновую задачу для проверки, не истекло ли допустимое время доставки с момента оформления. Если время просрочено, уменьшить цену заказа на 20%.

---

## 1. Сущность `Order`

### 1.1 Поля сущности

- **Id**: уникальный идентификатор заказа.
- **OrderType**: тип заказа (допустим, 3 варианта):
  - `Express` (экспресс-доставка),
  - `Standard` (стандартная доставка),
  - `Economy` (эконом-доставка).
- **Price**: стоимость заказа.
- **CreatedAt**: дата и время оформления заказа (можно автоматически проставлять текущее время при создании).
- _(Опционально)_ Любые дополнительные поля, например:
  - `CustomerName` (имя заказчика),
  - `DeliveryDeadline` (желаемая или расчетная дата доставки),
  - `IsDiscountApplied` (логический флаг, если нужно отслеживать, что скидка уже была применена).

### 1.2 Допустимое время доставки

Каждый тип заказа предполагает свое **ориентировочное** время доставки:
- `Express`: до 2 часов.
- `Standard`: до 1 дня.
- `Economy`: до 3 дней.

*(Цифры условные, вы можете настроить свои значения.)*

### 1.3 CRUD-операции (Create, Read, Update, Delete)

Необходимо реализовать API, позволяющее выполнять CRUD операции:

1. **Create** `/api/orders`
2. **GET `/api/orders`**
3. **GET `/api/orders/{id}`** 
4. **Update** `/api/orders/{id}`:
5. **Delete** `/api/orders/{id}`:

---

## 2. Логика проверки времени и скидка 20%

### 2.1 Условие применения скидки

- Если с момента оформления заказа (`CreatedAt`) прошло **больше** времени, чем допустимо для соответствующего типа доставки (`OrderType`), цена (`Price`) должна быть уменьшена **на 20%**.

### 2.2 Пример

- Заказ типа `Express` создан в 10:00. Допустимое время — **2 часа**.
- В 12:30 (то есть через 2 часа 30 минут) заказ все еще не выполнен/доставлен.
- При проверке система видит, что прошло более 2 часов, поэтому уменьшает цену на 20%.

### 2.3 Реализация скидки

1. **Обновление `Price`**: цена должна быть уменьшена на 20% относительно первоначальной (или текущей, в зависимости от вашей логики).
2. **Флаг скидки** (_опционально_): можно ввести поле `IsDiscountApplied` (true/false), чтобы не применять скидку многократно.
3. **Логирование**: рекомендуется записывать действия в лог (например: «Скидка 20% применена к заказу #123: просрочена доставка»).

---

## 3. Фоновая задача (Background Task)

### 3.1 Цель

Периодически **проверять все заказы** и смотреть, не превысили ли они допустимое время доставки для своего типа. Если время просрочено, применять 20%-ную скидку и сохранять изменения в базе.

### 3.2 Расписание запуска

- Выберите интервал для выполнения задачи (например, каждые 15 минут, 30 минут или каждый час).
- При каждом срабатывании задача должна:
  1. Считать заказы из базы данных.
  2. Определить, какие из них просрочены.
  3. Уменьшить их цену на 20%, если скидка еще не применялась.
  4. Записать результат в лог (или консоль).

